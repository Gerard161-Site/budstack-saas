generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/healingbuds_website/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Tenant {
  id            String          @id @default(cuid())
  businessName  String
  subdomain     String          @unique
  customDomain  String?         @unique
  nftTokenId    String?
  isActive      Boolean         @default(false)
  settings      Json?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  countryCode   String          @default("PT")
  templateId    String?
  consultations Consultation[]
  orders        Order[]
  products      Product[]
  branding      TenantBranding?
  template      Template?       @relation(fields: [templateId], references: [id])
  users         User[]

  @@map("tenants")
}

model TenantBranding {
  id             String   @id @default(cuid())
  tenantId       String   @unique
  logoUrl        String?
  faviconUrl     String?
  primaryColor   String   @default("#10b981")
  secondaryColor String   @default("#059669")
  accentColor    String   @default("#34d399")
  fontFamily     String   @default("Inter")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("tenant_branding")
}

model User {
  id               String         @id @default(cuid())
  email            String         @unique
  password         String
  name             String?
  role             Role           @default(PATIENT)
  tenantId         String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  resetToken       String?        @unique
  resetTokenExpiry DateTime?
  consultations    Consultation[]
  orders           Order[]
  tenant           Tenant?        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("users")
}

model Product {
  id          String      @id @default(cuid())
  name        String
  slug        String
  description String?
  category    String
  strainType  StrainType?
  thcContent  Float?
  cbdContent  Float?
  price       Float
  stock       Int         @default(0)
  images      String[]
  tenantId    String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([slug, tenantId])
  @@map("products")
}

model Order {
  id           String      @id @default(cuid())
  userId       String
  tenantId     String
  total        Float
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  notes        String?
  orderNumber  String      @unique @default(cuid())
  shippingCost Float       @default(5.00)
  shippingInfo Json?
  subtotal     Float
  status       OrderStatus @default(PENDING)
  items        OrderItem[]
  tenant       Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("orders")
}

model OrderItem {
  id          String   @id @default(cuid())
  orderId     String
  productId   String
  productName String
  quantity    Int
  price       Float
  createdAt   DateTime @default(now())
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

model Consultation {
  id        String             @id @default(cuid())
  userId    String
  tenantId  String
  status    ConsultationStatus @default(PENDING)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  tenant    Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("consultations")
}

model ConsultationQuestionnaire {
  id                   String   @id @default(cuid())
  tenantId             String?
  
  // Contact Details
  firstName            String
  lastName             String
  email                String
  phoneCode            String
  phoneNumber          String
  dateOfBirth          DateTime
  gender               String
  password             String
  
  // Shipping Address
  addressLine1         String
  addressLine2         String?
  city                 String
  state                String
  postalCode           String
  country              String
  countryCode          String
  
  // Business Info (Optional)
  businessType         String?
  businessName         String?
  businessAddress1     String?
  businessAddress2     String?
  businessCity         String?
  businessState        String?
  businessPostalCode   String?
  businessCountry      String?
  businessCountryCode  String?
  
  // Medical Conditions (multi-select)
  medicalConditions    String[] @default([])
  otherCondition       String?
  prescribedMedications String[] @default([])
  prescribedSupplements String?
  
  // Medical History Part 1
  hasHeartProblems     Boolean  @default(false)
  hasCancerTreatment   Boolean  @default(false)
  hasImmunosuppressants Boolean  @default(false)
  hasLiverDisease      Boolean  @default(false)
  hasPsychiatricHistory Boolean  @default(false)
  
  // Medical History Part 2
  hasAlcoholAbuse      Boolean  @default(false)
  hasDrugServices      Boolean  @default(false)
  alcoholUnitsPerWeek  String?
  cannabisReducesMeds  Boolean  @default(false)
  cannabisFrequency    String?
  cannabisAmountPerDay String?
  
  // Submission tracking
  drGreenClientId      String?
  submittedToDrGreen   Boolean  @default(false)
  submissionError      String?
  
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("consultation_questionnaires")
}

model PlatformSettings {
  id                String   @id @default("platform")
  businessName      String   @default("BudStack")
  tagline           String?
  logoUrl           String?
  faviconUrl        String?
  primaryColor      String   @default("#059669")
  secondaryColor    String   @default("#34d399")
  accentColor       String   @default("#10b981")
  backgroundColor   String   @default("#ffffff")
  textColor         String   @default("#1f2937")
  headingColor      String   @default("#111827")
  fontFamily        String   @default("inter")
  headingFontFamily String   @default("inter")
  template          String   @default("modern")
  updatedAt         DateTime @updatedAt

  @@map("platform_settings")
}

model Template {
  id             String   @id @default(cuid())
  name           String
  description    String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  assetsPath     String?
  author         String?
  category       String   @default("modern")
  componentsPath String?
  demoUrl        String?
  downloadCount  Int      @default(0)
  isPremium      Boolean  @default(false)
  layoutFilePath String?
  metadata       Json?
  packagePath    String?
  previewUrl     String?
  price          Float?
  slug           String?  @unique
  stylesPath     String?
  tags           String[]
  thumbnailUrl   String?
  usageCount     Int      @default(0)
  version        String   @default("1.0.0")
  tenants        Tenant[]

  @@map("templates")
}

model AuditLog {
  id          String   @id @default(cuid())
  action      String
  entityType  String
  entityId    String?
  userId      String?
  userEmail   String?
  tenantId    String?
  metadata    Json?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@index([tenantId, createdAt])
  @@index([userId, createdAt])
  @@index([action, createdAt])
  @@map("audit_logs")
}

model Webhook {
  id          String        @id @default(cuid())
  tenantId    String?
  url         String
  events      String[]
  secret      String
  isActive    Boolean       @default(true)
  description String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  deliveries  WebhookDelivery[]

  @@index([tenantId])
  @@map("webhooks")
}

model WebhookDelivery {
  id           String   @id @default(cuid())
  webhookId    String
  event        String
  payload      Json
  statusCode   Int?
  response     String?
  success      Boolean  @default(false)
  attemptCount Int      @default(1)
  nextRetry    DateTime?
  createdAt    DateTime @default(now())
  webhook      Webhook  @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId, createdAt])
  @@index([success, nextRetry])
  @@map("webhook_deliveries")
}

enum Role {
  PATIENT
  TENANT_ADMIN
  SUPER_ADMIN
}

enum StrainType {
  SATIVA
  INDICA
  HYBRID
}

enum ConsultationStatus {
  PENDING
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}
